<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The theory of correspondences analyses - Canonical Correspondence Analysis (CCA)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The theory of correspondences analyses</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./CA.html" rel="" target="">
 <span class="menu-text">Correspondence analysis (CA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./CCA.html" rel="" target="" aria-current="page">
 <span class="menu-text">Canonical CA (CCA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dcCA.html" rel="" target="">
 <span class="menu-text">Double constrained CA (dc-CA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./CCorA.html" rel="" target="">
 <span class="menu-text">Canonical correlation analysis (CCorA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./recscal.html" rel="" target="">
 <span class="menu-text">Reciprocal scaling (CA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./recscal_cca.html" rel="" target="">
 <span class="menu-text">Reciprocal scaling (CCA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./recscal_dcca.html" rel="" target="">
 <span class="menu-text">Reciprocal scaling (dc-CA)</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#computation" id="toc-computation" class="nav-link" data-scroll-target="#computation">Computation</a>
  <ul>
  <li><a href="#transform-matrix" id="toc-transform-matrix" class="nav-link" data-scroll-target="#transform-matrix">Transform matrix</a></li>
  <li><a href="#weights-on-e" id="toc-weights-on-e" class="nav-link" data-scroll-target="#weights-on-e">Weights on <span class="math inline">\(E\)</span></a></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression">Regression</a></li>
  <li><a href="#diagonalization-of-s_hatp_0top-hatp_0" id="toc-diagonalization-of-s_hatp_0top-hatp_0" class="nav-link" data-scroll-target="#diagonalization-of-s_hatp_0top-hatp_0">Diagonalization of <span class="math inline">\(S_{\hat{P_0}^\top \hat{P_0}}\)</span></a></li>
  <li><a href="#compute-u-and-v" id="toc-compute-u-and-v" class="nav-link" data-scroll-target="#compute-u-and-v">Compute <span class="math inline">\(U\)</span> and <span class="math inline">\(V\)</span></a></li>
  </ul></li>
  <li><a href="#scaling" id="toc-scaling" class="nav-link" data-scroll-target="#scaling">Scaling</a>
  <ul>
  <li><a href="#pre-computations" id="toc-pre-computations" class="nav-link" data-scroll-target="#pre-computations">Pre-computations</a></li>
  <li><a href="#scaling-type-1" id="toc-scaling-type-1" class="nav-link" data-scroll-target="#scaling-type-1">Scaling type 1</a>
  <ul>
  <li><a href="#weighted-averaging" id="toc-weighted-averaging" class="nav-link" data-scroll-target="#weighted-averaging">Weighted averaging</a></li>
  <li><a href="#plots" id="toc-plots" class="nav-link" data-scroll-target="#plots">Plots</a></li>
  </ul></li>
  <li><a href="#scaling-type-2" id="toc-scaling-type-2" class="nav-link" data-scroll-target="#scaling-type-2">Scaling type 2</a>
  <ul>
  <li><a href="#weighted-averaging-1" id="toc-weighted-averaging-1" class="nav-link" data-scroll-target="#weighted-averaging-1">Weighted averaging</a></li>
  <li><a href="#plots-1" id="toc-plots-1" class="nav-link" data-scroll-target="#plots-1">Plots</a></li>
  </ul></li>
  <li><a href="#scaling-type-3" id="toc-scaling-type-3" class="nav-link" data-scroll-target="#scaling-type-3">Scaling type 3</a></li>
  <li><a href="#plots-2" id="toc-plots-2" class="nav-link" data-scroll-target="#plots-2">Plots</a></li>
  </ul></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a>
  <ul>
  <li><a href="#residual-analysis" id="toc-residual-analysis" class="nav-link" data-scroll-target="#residual-analysis">Residual analysis</a></li>
  <li><a href="#tests-of-significance" id="toc-tests-of-significance" class="nav-link" data-scroll-target="#tests-of-significance">Tests of significance</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Canonical Correspondence Analysis (CCA)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Paths</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Multivariate analysis</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ade4)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adegraphics)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrix algebra</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(expm)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CAnetwork)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define bound for comparison to zero</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>zero <span class="ot">&lt;-</span> <span class="fl">10e-10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>The contents of this page relies heavily on <span class="citation" data-cites="legendre2012">Legendre and Legendre (<a href="#ref-legendre2012" role="doc-biblioref">2012</a>)</span>.</em></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>CCA is a method of the family of <em>canonical</em> or <em>direct gradient analyses</em>, in which a matrix of predictor variables intervenes in the computation of the ordination vectors.</p>
<p>CCA is an asymmetric method because the predictor variables and the response variables are not equivalent in the analysis.</p>
<p>CCA takes two matrices in input:</p>
<ul>
<li>A data matrix <span class="math inline">\(Y\)</span> (<span class="math inline">\(r \times c\)</span>)</li>
<li>A matrix of predictor variables <span class="math inline">\(E\)</span> (<span class="math inline">\(r \times l\)</span>)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data/Barbaro2012.rds"</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> dat<span class="sc">$</span>comm</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> dat<span class="sc">$</span>envir</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">dim</span>(Y)[<span class="dv">1</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">dim</span>(Y)[<span class="dv">2</span>]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">dim</span>(E)[<span class="dv">2</span>]</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plotmat</span>(<span class="at">r =</span> r, <span class="at">c =</span> c, <span class="at">l =</span> l, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">E =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here, <span class="math inline">\(Y\)</span> represents the abundance of different bird species (columns) at different sites (rows):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">sp1</th>
<th style="text-align: right;">sp2</th>
<th style="text-align: right;">sp3</th>
<th style="text-align: right;">sp4</th>
<th style="text-align: right;">sp5</th>
<th style="text-align: right;">sp6</th>
<th style="text-align: right;">sp7</th>
<th style="text-align: right;">sp8</th>
<th style="text-align: right;">sp9</th>
<th style="text-align: right;">sp10</th>
<th style="text-align: right;">sp11</th>
<th style="text-align: right;">sp12</th>
<th style="text-align: right;">sp13</th>
<th style="text-align: right;">sp14</th>
<th style="text-align: right;">sp15</th>
<th style="text-align: right;">sp16</th>
<th style="text-align: right;">sp17</th>
<th style="text-align: right;">sp18</th>
<th style="text-align: right;">sp19</th>
<th style="text-align: right;">sp21</th>
<th style="text-align: right;">sp22</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><span class="math inline">\(E\)</span> represents environmental variables (columns) associated to each site (rows).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(E))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">location</th>
<th style="text-align: right;">elevation</th>
<th style="text-align: right;">patch_area</th>
<th style="text-align: right;">perc_forests</th>
<th style="text-align: right;">perc_grasslands</th>
<th style="text-align: right;">ShannonLandscapeDiv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">6.28</td>
<td style="text-align: right;">7.7882</td>
<td style="text-align: right;">67.7785</td>
<td style="text-align: right;">0.232</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">7.92</td>
<td style="text-align: right;">16.4129</td>
<td style="text-align: right;">43.4066</td>
<td style="text-align: right;">0.274</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">430</td>
<td style="text-align: right;">83.24</td>
<td style="text-align: right;">24.4526</td>
<td style="text-align: right;">28.4995</td>
<td style="text-align: right;">0.274</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">420</td>
<td style="text-align: right;">140.83</td>
<td style="text-align: right;">41.9966</td>
<td style="text-align: right;">34.2412</td>
<td style="text-align: right;">0.260</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">140.83</td>
<td style="text-align: right;">41.9966</td>
<td style="text-align: right;">34.2412</td>
<td style="text-align: right;">0.260</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">7.5445</td>
<td style="text-align: right;">67.0780</td>
<td style="text-align: right;">0.240</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(r <span class="ot">&lt;-</span> <span class="fu">dim</span>(Y)[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(c <span class="ot">&lt;-</span> <span class="fu">dim</span>(Y)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(l <span class="ot">&lt;-</span> <span class="fu">dim</span>(E)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
</section>
<section id="computation" class="level2">
<h2 class="anchored" data-anchor-id="computation">Computation</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="*TL;DR*">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<em>TL;DR</em>
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have a data matrix <span class="math inline">\(Y\)</span> (<span class="math inline">\(r \times c\)</span>) and a matrix <span class="math inline">\(E\)</span> (<span class="math inline">\(r \times l\)</span>) of predictors variables.</p>
<p>We regress <span class="math inline">\(P_0\)</span> (“centered” <span class="math inline">\(Y\)</span>) on <span class="math inline">\(E_{stand}\)</span> (which is the centered and scaled <span class="math inline">\(E\)</span> matrix):</p>
<p><span class="math display">\[
\hat{P_0} = D_r^{1/2} E_{stand}B
\]</span></p>
<p>Then, we diagonalize matrix <span class="math inline">\(S_{\hat{P_0}^\top \hat{P_0}} = \hat{P_0}^\top\hat{P_0}\)</span>.</p>
<p><span class="math display">\[
S_{\hat{P_0}^\top\hat{P_0}} =  V_0 \Lambda V_0^{-1}
\]</span></p>
<p>The matrix <span class="math inline">\(V_0\)</span> (<span class="math inline">\(c \times \text{mindim}\)</span>) contains the loadings of the columns (species) of the contingency table. There are <span class="math inline">\(\text{mindim} = \min(r-1, c, l)\)</span> non-null eigenvalues.</p>
<p>Then, we can find the rows (sites) observed scores <span class="math inline">\(U_0\)</span> (<span class="math inline">\(r \times \text{mindim}\)</span>) from the eigenvectors of the multivariate space using the following formula:</p>
<p><span class="math display">\[
U_0 = P_0 V_0 \Lambda^{-1/2}
\]</span></p>
<p>Here, it is important to note that <span class="math inline">\(U_0\)</span> contains the loadings of the sites computed <em>from the observed data matrix</em> <span class="math inline">\(P_0\)</span>, i.e.&nbsp;the latent ordination of the sites not taking into account the sites variables. The position of the sites taking into account the regression will be defined below in the <a href="#scaling">scalings</a> section.</p>
<p>Finally, we define the following transformations of <span class="math inline">\(U_0\)</span> and <span class="math inline">\(V_0\)</span> (<span class="math inline">\(V_0\)</span> corresponds to <code>c1</code>):</p>
<p><span class="math display">\[
\left\{
\begin{array}{ll}
  U &amp;= D_r^{-1/2} U_0\\
  V &amp;= D_c^{-1/2} V_0\\
\end{array}
\right.
\]</span> This transformation is similar to the <a href="./CA.html#define-u-and-v">transformation applied to CA eigenvectors</a>.</p>
</div>
</div>
<section id="transform-matrix" class="level3">
<h3 class="anchored" data-anchor-id="transform-matrix">Transform matrix</h3>
<p>We start by “centering” the matrix <span class="math inline">\(Y\)</span> to get <span class="math inline">\(P_0\)</span> (<a href="./CA.html#transform-the-table CA">just like with CA</a>).</p>
<p><span class="math display">\[
P = Y/y_{\cdot \cdot}
\]</span></p>
<p><span class="math display">\[
P_0 = [p_{0ij}] = \left[ \frac{p_{ij} - p_{i\cdot} p_{\cdot j}}{\sqrt{p_{i\cdot} p_{\cdot j}}} \right]
\]</span></p>
<p>Here, we have:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> Y<span class="sc">/</span><span class="fu">sum</span>(Y)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize P0 matrix</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>P0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">ncol</span>(Y), <span class="at">nrow =</span> <span class="fu">nrow</span>(Y))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(P0) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(Y)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(P0) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(Y)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Y)) { <span class="co"># For each row</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(Y)) { <span class="co"># For each column</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Do the sum</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    pi_ <span class="ot">&lt;-</span> <span class="fu">sum</span>(P[i, ])</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    p_j <span class="ot">&lt;-</span> <span class="fu">sum</span>(P[, j])</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the transformation</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    P0[i, j] <span class="ot">&lt;-</span> (P[i, j] <span class="sc">-</span> (pi_<span class="sc">*</span>p_j))<span class="sc">/</span><span class="fu">sqrt</span>(pi_<span class="sc">*</span>p_j)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(P0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">sp1</th>
<th style="text-align: right;">sp2</th>
<th style="text-align: right;">sp3</th>
<th style="text-align: right;">sp4</th>
<th style="text-align: right;">sp5</th>
<th style="text-align: right;">sp6</th>
<th style="text-align: right;">sp7</th>
<th style="text-align: right;">sp8</th>
<th style="text-align: right;">sp9</th>
<th style="text-align: right;">sp10</th>
<th style="text-align: right;">sp11</th>
<th style="text-align: right;">sp12</th>
<th style="text-align: right;">sp13</th>
<th style="text-align: right;">sp14</th>
<th style="text-align: right;">sp15</th>
<th style="text-align: right;">sp16</th>
<th style="text-align: right;">sp17</th>
<th style="text-align: right;">sp18</th>
<th style="text-align: right;">sp19</th>
<th style="text-align: right;">sp21</th>
<th style="text-align: right;">sp22</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-0.0246174</td>
<td style="text-align: right;">-0.0235678</td>
<td style="text-align: right;">0.1819102</td>
<td style="text-align: right;">0.0177849</td>
<td style="text-align: right;">-0.0086058</td>
<td style="text-align: right;">0.0190444</td>
<td style="text-align: right;">-0.0060852</td>
<td style="text-align: right;">0.0389306</td>
<td style="text-align: right;">-0.0172115</td>
<td style="text-align: right;">0.0177849</td>
<td style="text-align: right;">0.0142185</td>
<td style="text-align: right;">-0.0285421</td>
<td style="text-align: right;">-0.0121704</td>
<td style="text-align: right;">-0.0086058</td>
<td style="text-align: right;">-0.0172115</td>
<td style="text-align: right;">-0.0136069</td>
<td style="text-align: right;">-0.0172115</td>
<td style="text-align: right;">-0.0425963</td>
<td style="text-align: right;">0.0259875</td>
<td style="text-align: right;">-0.0227687</td>
<td style="text-align: right;">-0.0250899</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.0700532</td>
<td style="text-align: right;">-0.0430288</td>
<td style="text-align: right;">-0.0192431</td>
<td style="text-align: right;">-0.0075494</td>
<td style="text-align: right;">-0.0157119</td>
<td style="text-align: right;">-0.0362309</td>
<td style="text-align: right;">-0.0111100</td>
<td style="text-align: right;">0.0317935</td>
<td style="text-align: right;">-0.0314238</td>
<td style="text-align: right;">-0.0075494</td>
<td style="text-align: right;">-0.0702658</td>
<td style="text-align: right;">0.0257394</td>
<td style="text-align: right;">0.3429284</td>
<td style="text-align: right;">-0.0157119</td>
<td style="text-align: right;">0.1622254</td>
<td style="text-align: right;">0.2201063</td>
<td style="text-align: right;">-0.0314238</td>
<td style="text-align: right;">0.0004761</td>
<td style="text-align: right;">-0.0290665</td>
<td style="text-align: right;">-0.0415698</td>
<td style="text-align: right;">0.0427538</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.0325898</td>
<td style="text-align: right;">-0.0342433</td>
<td style="text-align: right;">-0.0153141</td>
<td style="text-align: right;">0.0216502</td>
<td style="text-align: right;">-0.0125039</td>
<td style="text-align: right;">-0.0148135</td>
<td style="text-align: right;">-0.0088416</td>
<td style="text-align: right;">-0.0092517</td>
<td style="text-align: right;">-0.0250078</td>
<td style="text-align: right;">-0.0160655</td>
<td style="text-align: right;">0.0166286</td>
<td style="text-align: right;">-0.0414707</td>
<td style="text-align: right;">-0.0176832</td>
<td style="text-align: right;">-0.0125039</td>
<td style="text-align: right;">-0.0250078</td>
<td style="text-align: right;">-0.0197704</td>
<td style="text-align: right;">-0.0250078</td>
<td style="text-align: right;">0.0364300</td>
<td style="text-align: right;">0.0331807</td>
<td style="text-align: right;">-0.0330822</td>
<td style="text-align: right;">0.0191867</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.0149125</td>
<td style="text-align: right;">-0.0283250</td>
<td style="text-align: right;">-0.0126673</td>
<td style="text-align: right;">-0.0444862</td>
<td style="text-align: right;">-0.0103428</td>
<td style="text-align: right;">0.0023441</td>
<td style="text-align: right;">-0.0073135</td>
<td style="text-align: right;">0.0865729</td>
<td style="text-align: right;">0.0773724</td>
<td style="text-align: right;">-0.0444862</td>
<td style="text-align: right;">-0.0024017</td>
<td style="text-align: right;">-0.0343033</td>
<td style="text-align: right;">-0.0146270</td>
<td style="text-align: right;">-0.0103428</td>
<td style="text-align: right;">-0.0206857</td>
<td style="text-align: right;">-0.0163535</td>
<td style="text-align: right;">-0.0206857</td>
<td style="text-align: right;">0.0280484</td>
<td style="text-align: right;">-0.0407198</td>
<td style="text-align: right;">-0.0273646</td>
<td style="text-align: right;">0.0371130</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.0381182</td>
<td style="text-align: right;">-0.0333300</td>
<td style="text-align: right;">-0.0149056</td>
<td style="text-align: right;">-0.0135976</td>
<td style="text-align: right;">-0.0121704</td>
<td style="text-align: right;">-0.0123509</td>
<td style="text-align: right;">-0.0086058</td>
<td style="text-align: right;">-0.0058019</td>
<td style="text-align: right;">-0.0243408</td>
<td style="text-align: right;">-0.0523468</td>
<td style="text-align: right;">0.0573758</td>
<td style="text-align: right;">-0.0403646</td>
<td style="text-align: right;">-0.0172115</td>
<td style="text-align: right;">-0.0121704</td>
<td style="text-align: right;">-0.0243408</td>
<td style="text-align: right;">0.0861662</td>
<td style="text-align: right;">-0.0243408</td>
<td style="text-align: right;">0.0407749</td>
<td style="text-align: right;">-0.0055815</td>
<td style="text-align: right;">-0.0321998</td>
<td style="text-align: right;">0.0216837</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.0648859</td>
<td style="text-align: right;">-0.0351329</td>
<td style="text-align: right;">-0.0157119</td>
<td style="text-align: right;">-0.0184176</td>
<td style="text-align: right;">-0.0128287</td>
<td style="text-align: right;">0.0201080</td>
<td style="text-align: right;">-0.0090713</td>
<td style="text-align: right;">0.0163368</td>
<td style="text-align: right;">0.0533995</td>
<td style="text-align: right;">0.0183431</td>
<td style="text-align: right;">-0.0220164</td>
<td style="text-align: right;">-0.0425480</td>
<td style="text-align: right;">-0.0181425</td>
<td style="text-align: right;">-0.0128287</td>
<td style="text-align: right;">0.0533995</td>
<td style="text-align: right;">-0.0202840</td>
<td style="text-align: right;">0.0533995</td>
<td style="text-align: right;">0.0003888</td>
<td style="text-align: right;">0.0298152</td>
<td style="text-align: right;">-0.0339416</td>
<td style="text-align: right;">0.1252960</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="weights-on-e" class="level3">
<h3 class="anchored" data-anchor-id="weights-on-e">Weights on <span class="math inline">\(E\)</span></h3>
<p>We standardize <span class="math inline">\(E\)</span> as <span class="math inline">\(E_{stand}\)</span>, but we standardize so that the variables associated to the sites which have more observations have more weight. Therefore, we standardize <span class="math inline">\(E\)</span> with the weights <span class="math inline">\(y_{i\cdot}/r\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>E_wt <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(Y)<span class="sc">/</span><span class="fu">nrow</span>(E)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>Estand <span class="ot">&lt;-</span> <span class="fu">scalewt</span>(E, <span class="at">wt =</span> E_wt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(Estand))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 19%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">location</th>
<th style="text-align: right;">elevation</th>
<th style="text-align: right;">patch_area</th>
<th style="text-align: right;">perc_forests</th>
<th style="text-align: right;">perc_grasslands</th>
<th style="text-align: right;">ShannonLandscapeDiv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-0.8940191</td>
<td style="text-align: right;">-1.4578384</td>
<td style="text-align: right;">-0.5429520</td>
<td style="text-align: right;">-1.0404731</td>
<td style="text-align: right;">1.0369741</td>
<td style="text-align: right;">-1.0351817</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.8940191</td>
<td style="text-align: right;">-1.3502706</td>
<td style="text-align: right;">-0.5081483</td>
<td style="text-align: right;">-0.3311255</td>
<td style="text-align: right;">-0.4345644</td>
<td style="text-align: right;">1.0954816</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-0.8940191</td>
<td style="text-align: right;">0.8010856</td>
<td style="text-align: right;">1.0902771</td>
<td style="text-align: right;">0.3301082</td>
<td style="text-align: right;">-1.3346326</td>
<td style="text-align: right;">1.0954816</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.8940191</td>
<td style="text-align: right;">0.7473017</td>
<td style="text-align: right;">2.3124400</td>
<td style="text-align: right;">1.7730331</td>
<td style="text-align: right;">-0.9879574</td>
<td style="text-align: right;">0.3852605</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-0.8940191</td>
<td style="text-align: right;">0.6397339</td>
<td style="text-align: right;">2.3124400</td>
<td style="text-align: right;">1.7730331</td>
<td style="text-align: right;">-0.9879574</td>
<td style="text-align: right;">0.3852605</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.8940191</td>
<td style="text-align: right;">1.1775730</td>
<td style="text-align: right;">-0.6656140</td>
<td style="text-align: right;">-1.0605165</td>
<td style="text-align: right;">0.9946790</td>
<td style="text-align: right;">-0.6293411</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Conceptually, it is equivalent to using the inflated matrix <span class="math inline">\(E_{infl}\)</span> to compute its mean <span class="math inline">\(\bar{E}_{infl}\)</span> and standard deviation <span class="math inline">\(\sigma(E_{infl})\)</span> per column. In <span class="math inline">\(E_{infl}\)</span>, the rows corresponding to each site are duplicates as many times as there are observations for this given site (so that <span class="math inline">\(E_{infl}\)</span> is of dimension <span class="math inline">\(y_{\cdot \cdot} \times l\)</span>).</p>
<p><span class="math display">\[
E_{stand} = \frac{E - \bar{E}_{infl}}{\sigma(E_{infl})}
\]</span></p>
<p>With our data: first, we compute <span class="math inline">\(E_{infl}\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Einfl <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="dv">0</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncol =</span> <span class="fu">ncol</span>(E), </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrow =</span> <span class="fu">sum</span>(Y))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Einfl) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(E)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Einfl) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Einfl)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the number of times to duplicate each site</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>nrep_sites <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(Y)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>nrstart <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(E)) {</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  ri <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(E)[i, ]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  rname <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E)[i]</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get how many times to duplicate this site</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  nr <span class="ot">&lt;-</span> nrep_sites[<span class="fu">as.character</span>(rname)]</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  Einfl[(nrstart<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(nrstart<span class="sc">+</span>nr), ] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(ri, nr), </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">nrow =</span> nr, </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(Einfl)[(nrstart<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(nrstart<span class="sc">+</span>nr)] <span class="ot">&lt;-</span> <span class="fu">paste</span>(rname,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                                                     <span class="dv">1</span><span class="sc">:</span>nr,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  nrstart <span class="ot">&lt;-</span> nrstart <span class="sc">+</span> nr</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Dimension of Einfl:"</span>, <span class="fu">paste</span>(<span class="fu">dim</span>(Einfl), <span class="at">collapse =</span> <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dimension of Einfl: 493 6"</code></pre>
</div>
</div>
<p>Then, we compute the mean and standard deviation per column and standardize <span class="math inline">\(E\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Einfl_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(Einfl, <span class="dv">2</span>, mean)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Einfl)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>Einfl_sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(Einfl, <span class="dv">2</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">function</span>(x) <span class="fu">sd</span>(x)<span class="sc">*</span><span class="fu">sqrt</span>((n<span class="dv">-1</span>)<span class="sc">/</span>n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Estand2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(E, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">center =</span> Einfl_mean,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">scale =</span> Einfl_sd)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(Estand2<span class="sc">/</span>Estand <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="regression" class="level3">
<h3 class="anchored" data-anchor-id="regression">Regression</h3>
<p>After that, we perform the weighted multiple linear regression of <span class="math inline">\(P_0\)</span> by <span class="math inline">\(E_{stand}\)</span>. <span class="math inline">\(P_0\)</span> is approximated by <span class="math inline">\(\hat{P_0}\)</span> using multiple linear regression on <span class="math inline">\(E_{stand}\)</span>: for each row, we can write <span class="math inline">\(\hat{p_{0i\cdot}} = b_0 + b_1 e_{1\cdot} + \ldots + b_e e_{l\cdot}\)</span>, where <span class="math inline">\(e_i\)</span> are columns of <span class="math inline">\(E_{stand}\)</span> and <span class="math inline">\(b_i\)</span> are regression coefficients.</p>
<p>In a matrix form, it is written:</p>
<p><span class="math display">\[
\hat{P_0} = D_r^{1/2}E_{stand}B
\]</span></p>
<p>Where</p>
<p><span class="math display">\[
B = [E_{stand}^\top D_r E_{stand}]^{-1}E_{stand}^\top D_r^{1/2}P_0
\]</span></p>
<p>With our example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagonal matrix weights</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(P)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>Dr <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Dr) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(P)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression coefficient</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(Estand) <span class="sc">%*%</span> Dr <span class="sc">%*%</span> Estand) <span class="sc">%*%</span> <span class="fu">t</span>(Estand) <span class="sc">%*%</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> P0</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute predicted values</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>P0hat <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> Estand <span class="sc">%*%</span> B</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(P0hat) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(P0)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(P0hat) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(P0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we can get the predicted values for <span class="math inline">\(P_0\)</span>. For instance, let’s plot predicted vs observed values for site 2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predicted and observed values for one site</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> P0hat[ind, ]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> P0[ind, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">predicted =</span> pred, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">observed =</span> obs, </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names =</span> <span class="fu">names</span>(pred))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"predicted"</span>, <span class="st">"observed"</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">"type"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(names, value, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> value, <span class="at">col =</span> type, <span class="at">group =</span> type)) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Values of P0"</span>) <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Species"</span>) <span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="diagonalization-of-s_hatp_0top-hatp_0" class="level3">
<h3 class="anchored" data-anchor-id="diagonalization-of-s_hatp_0top-hatp_0">Diagonalization of <span class="math inline">\(S_{\hat{P_0}^\top \hat{P_0}}\)</span></h3>
<p>Then, we diagonalize the covariance matrix of predicted values <span class="math inline">\(S_{\hat{P_0}^\top \hat{P_0}}\)</span>.</p>
<p>First, we compute the covariance matrix (note that here we don’t divide by the degrees of freedom).</p>
<p><span class="math display">\[
S_{\hat{P_0}^\top \hat{P_0}} = \hat{P_0}^\top \hat{P_0}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Spp <span class="ot">&lt;-</span> <span class="fu">t</span>(P0hat) <span class="sc">%*%</span> P0hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Covariance matrix of predicted P0 is equal to that</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Spe <span class="ot">&lt;-</span> <span class="fu">t</span>(P0hat) <span class="sc">%*%</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> <span class="fu">as.matrix</span>(Estand)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>See <span class="ot">&lt;-</span> <span class="fu">t</span>(Estand) <span class="sc">%*%</span> Dr <span class="sc">%*%</span> <span class="fu">as.matrix</span>(Estand)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>Spp2 <span class="ot">&lt;-</span> Spe <span class="sc">%*%</span> <span class="fu">solve</span>(See) <span class="sc">%*%</span> <span class="fu">t</span>(Spe)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(Spp<span class="sc">/</span>Spp2 <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We diagonalize <span class="math inline">\(S_{\hat{P_0}^\top \hat{P_0}}\)</span>:</p>
<p><span class="math display">\[
S_{\hat{P_0}^\top \hat{P_0}} = V_0 \Lambda V_0^{-1}
\]</span></p>
<p><span class="math inline">\(\Lambda\)</span> is the matrix of eigenvalues (there are <span class="math inline">\(\min(r-1, c, l)\)</span> non-null eigenvalues) and <span class="math inline">\(V_0\)</span> contains the columns (species) loadings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>neig <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">c</span>(r<span class="dv">-1</span>, c, l))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, <span class="math inline">\(r-1 =\)</span> 25, <span class="math inline">\(c =\)</span> 21 and <span class="math inline">\(l =\)</span> 6 so the minimum (and the number of eigenvalues) is 6.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>eig <span class="ot">&lt;-</span> <span class="fu">eigen</span>(Spp)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>(lambda <span class="ot">&lt;-</span> eig<span class="sc">$</span>values) <span class="co"># There are l = 6 non-null eigenvalues</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1.846574e-01  1.571586e-01  1.009501e-01  8.711508e-02  3.222443e-02
 [6]  1.476469e-02  9.276798e-18  8.416776e-18  2.476628e-18  1.422189e-18
[11] -1.212603e-18 -1.597223e-18 -1.677170e-18 -2.007096e-18 -3.488219e-18
[16] -3.614024e-18 -5.174948e-18 -5.675276e-18 -6.196745e-18 -6.258539e-18
[21] -7.334976e-18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> lambda[<span class="dv">1</span><span class="sc">:</span>neig]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>Lambda <span class="ot">&lt;-</span> <span class="fu">diag</span>(lambda)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>V0 <span class="ot">&lt;-</span> eig<span class="sc">$</span>vectors[, <span class="dv">1</span><span class="sc">:</span>neig] <span class="co"># We keep only the eigenvectors</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(V0) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we can get the ordination of rows (sites) by projecting the observed values (matrix <span class="math inline">\(P_0\)</span>) onto the axes defined by the diagonalization (<span class="math inline">\(V_0\)</span>):</p>
<p><span class="math display">\[
U_0 = P_0 V_0 \Lambda^{-1/2}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> P0 <span class="sc">%*%</span> V0 <span class="sc">%*%</span> <span class="fu">diag</span>(lambda<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(U0) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(U0)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(U0, <span class="dv">2</span>, varfacwt, <span class="at">wt =</span> <span class="fu">rowSums</span>(P)) <span class="co"># Norm?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06513814 0.06770504 0.08019396 0.07772885 0.12867946 0.10202597</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The rows loadings <span class="math inline">\(U_0\)</span> are different from the loadings obtained by diagonalizing <span class="math inline">\(S_{hat{P_0} \hat{P_0}^\top}\)</span> or performing the SVD of <span class="math inline">\(\hat{P_0}\)</span>, because <span class="math inline">\(U_0\)</span> does not contain the loadings of <span class="math inline">\(\hat{P_0}\)</span> but the loadings of <span class="math inline">\(P_0\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is not the same as diagonalizing S_ppt</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>Sppt <span class="ot">&lt;-</span> P0hat <span class="sc">%*%</span> <span class="fu">t</span>(P0hat)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>eig2 <span class="ot">&lt;-</span> <span class="fu">eigen</span>(Sppt)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(eig2<span class="sc">$</span>vectors[,<span class="dv">1</span><span class="sc">:</span>neig]<span class="sc">/</span>U0 <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Eigenvectors are different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We perform the SVD</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sv <span class="ot">&lt;-</span> <span class="fu">svd</span>(P0hat)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(sv<span class="sc">$</span>u[, <span class="dv">1</span><span class="sc">:</span>neig]<span class="sc">/</span>U0) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Eigenvectors are different for U0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(sv<span class="sc">$</span>v[, <span class="dv">1</span><span class="sc">:</span>neig]<span class="sc">/</span>V0) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># But they are the same for V0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If U was computed as below (using the matrix of predicted values), it would give the same results as the diagonalization/SVD above (but it is not the case).</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute rows loadings differently</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>Uhat <span class="ot">&lt;-</span> P0hat <span class="sc">%*%</span> V0 <span class="sc">%*%</span> <span class="fu">diag</span>(lambda<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(Uhat<span class="sc">/</span>eig2<span class="sc">$</span>vectors[,<span class="dv">1</span><span class="sc">:</span>neig]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Eigenvectors are the same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(sv<span class="sc">$</span>u[, <span class="dv">1</span><span class="sc">:</span>l]<span class="sc">/</span>eig2<span class="sc">$</span>vectors[,<span class="dv">1</span><span class="sc">:</span>l]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Eigenvectors are the same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="compute-u-and-v" class="level3">
<h3 class="anchored" data-anchor-id="compute-u-and-v">Compute <span class="math inline">\(U\)</span> and <span class="math inline">\(V\)</span></h3>
<p>We compute <span class="math inline">\(U\)</span> and <span class="math inline">\(V\)</span> as:</p>
<p><span class="math display">\[
\left\{
\begin{array}{ll}
  U &amp;= D_r^{-1/2} U_0\\
  V &amp;= D_c^{-1/2} V_0\\
\end{array}
\right.
\]</span></p>
<p>First, we define the diagonal matrices with rows and columns weights (respectively <span class="math inline">\(D_r\)</span> and <span class="math inline">\(D_c\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define weights vectors and matrices</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(P)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> <span class="fu">colSums</span>(P)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>Dr <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>Dc <span class="ot">&lt;-</span> <span class="fu">diag</span>(dc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sites</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> U0</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Species</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">diag</span>(dc<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> V0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(U, <span class="dv">2</span>, varfacwt, <span class="at">wt =</span> dr)<span class="sc">/</span>lambda <span class="co"># variance larger than lambda, because it contains the residuals of P0hat as well!!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   7.244385   9.261437  14.814747  19.935957  96.297789 180.619015</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(V, <span class="dv">2</span>, varfacwt, <span class="at">wt =</span> dc) <span class="co"># variance is one</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1</code></pre>
</div>
</div>
</section>
</section>
<section id="scaling" class="level2">
<h2 class="anchored" data-anchor-id="scaling">Scaling</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="*TL;DR*">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<em>TL;DR</em>
</div>
</div>
<div class="callout-body-container callout-body">
<p>As with CA, we have scalings type 1, 2 and 3. There are 2 differences with CA:</p>
<ul>
<li>For the sites, we have 3 types of scores: the predicted sites scores <span class="math inline">\(Z\)</span> (LC scores), computed from the regression, the “observed” sites scores <span class="math inline">\(U\)</span> computed from the observed data matrix, and the weighted averages <span class="math inline">\(U^\star\)</span> (WA scores), computed from the species scores.</li>
<li>There are also scalings for the correlations of the explanatory variables with the axes.</li>
</ul>
<p><strong>Scaling type 1 (<span class="math inline">\(\alpha = 1\)</span>)</strong></p>
<ul>
<li>WA scores for rows (sites): <span class="math inline">\(U^\star = U \Lambda^{1/2}\)</span> (<code>ls</code>)</li>
<li>LC scores for rows (sites): <span class="math inline">\(Z_1 = D_r^{-1/2} \hat{P_0} V_0\)</span> (<code>li</code>)</li>
<li>Columns (species) scores: <span class="math inline">\(V = D_c^{-1/2} V_0\)</span> (<code>c1</code>)</li>
<li>Variables scores: <span class="math inline">\(BS_1 = E_{stand}^\top D_r Z_{stand} \Lambda^{1/2}\)</span></li>
</ul>
<p><strong>Scaling type 2 (<span class="math inline">\(\alpha = 0\)</span>)</strong></p>
<ul>
<li>WA scores for rows (sites): <span class="math inline">\(U = D_r^{-1/2} U_0\)</span> (not computed by ade4: sort of <code>ls1</code>, but variance not normed to one)</li>
<li>LC scores for rows (sites): <span class="math inline">\(Z_2 = D_r^{-1/2}\hat{P_0} V_0 \Lambda^{-1/2}\)</span> (<code>l1</code>)</li>
<li>Columns (species) scores: <span class="math inline">\(V^\star = V \Lambda^{1/2}\)</span> (<code>co</code>)</li>
<li>Variables scores: <span class="math inline">\(BS_2 = E_{stand}^\top D_r Z_{stand}\)</span></li>
</ul>
<p><strong>Scaling type 3 (<span class="math inline">\(\alpha = 1/2\)</span>)</strong></p>
<ul>
<li>WA scores for rows (sites): <span class="math inline">\(\hat{S}_3 = U \Lambda^{1/4}\)</span></li>
<li>LC scores for rows (sites): <span class="math inline">\(Z_3 = D_r^{-1/2}\hat{P_0} V_0 \Lambda^{-1/4}\)</span></li>
<li>Columns (species) scores: <span class="math inline">\(S_3 = V \Lambda^{1/4}\)</span></li>
<li>Variables scores: <span class="math inline">\(BS_3 = E_{stand}' D_r Z_{stand}\Lambda^{1/4}\)</span></li>
</ul>
<p><span class="math inline">\(V^\star\)</span> (columns/species) and <span class="math inline">\(U^\star\)</span> (rows/sites) correspond to weighted averagings, and cab be computed from <span class="math inline">\(U\)</span> (rows/sites) (resp. <span class="math inline">\(V\)</span> (columns/species)). See <a href="#eq-wa-sites">Equation&nbsp;1</a> and <a href="#eq-wa-spp">Equation&nbsp;2</a> below.</p>
<p><strong><em>How to find the fa (i.e.&nbsp;correlation coefficients for each environmental variable in the multivariate space)??</em></strong></p>
</div>
</div>
<p>Let’s compute CCA with <code>ade4</code> to compare results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>ca <span class="ot">&lt;-</span> <span class="fu">dudi.coa</span>(Y, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">nf =</span> c<span class="dv">-1</span>, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>cca <span class="ot">&lt;-</span> <span class="fu">pcaiv</span>(<span class="at">dudi =</span> ca, </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">df =</span> E,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">scannf =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">nf =</span> neig)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>lambda[<span class="dv">1</span><span class="sc">:</span>neig]<span class="sc">/</span>cca<span class="sc">$</span>eig <span class="co"># Eigenvalues are the same as computed manually</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1</code></pre>
</div>
</div>
<section id="pre-computations" class="level3">
<h3 class="anchored" data-anchor-id="pre-computations">Pre-computations</h3>
<p>The scores for the explanatory variables are computed from matrix <span class="math inline">\(Z_{stand}\)</span>: so we first need to standardize <span class="math inline">\(Z\)</span> into <span class="math inline">\(Z_{stand}\)</span> (the computation can involve <span class="math inline">\(Z_1\)</span>, <span class="math inline">\(Z_2\)</span> or <span class="math inline">\(Z_3\)</span> (defined below) and give the same result).</p>
<p><span class="math inline">\(Z_1\)</span>, <span class="math inline">\(Z_2\)</span> or <span class="math inline">\(Z_3\)</span> are defined as some variation of:</p>
<p><span class="math display">\[Z_i = D_r^{-1/2} \hat{P}_0 V_0 \Lambda^\alpha\]</span> where <span class="math inline">\(\alpha\)</span> is an exponent equal to 0, -1/2 or -1/4. This equation corresponds to the projection of the predicted data matrix <span class="math inline">\(\hat{P}_0\)</span> onto the multivariate space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Z1</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>Z1 <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> P0hat <span class="sc">%*%</span> V0</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(Z1, <span class="dv">2</span>, varfacwt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.17463933 0.17429419 0.09984546 0.08291203 0.03437735 0.01521229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>Z_wt <span class="ot">&lt;-</span> E_wt</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>Zstand <span class="ot">&lt;-</span> <span class="fu">scalewt</span>(Z1, <span class="at">wt =</span> Z_wt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is the same as computing with the inflated matrix (below):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute inflated matrix ------</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>Zinfl <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="dv">0</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncol =</span> <span class="fu">ncol</span>(Z1), </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrow =</span> <span class="fu">sum</span>(Y))</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Zinfl) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Zinfl)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Give names to Z1</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Z1) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(Y)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the number of times to duplicate each site</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>nrep_sites <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(Y)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>nrstart <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Z1)) {</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  ri <span class="ot">&lt;-</span> Z1[i, ]</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  rname <span class="ot">&lt;-</span> <span class="fu">rownames</span>(Z1)[i]</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get how many times to duplicate this site</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  nr <span class="ot">&lt;-</span> nrep_sites[<span class="fu">as.character</span>(rname)]</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>  Zinfl[(nrstart<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(nrstart<span class="sc">+</span>nr), ] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(ri, nr), </span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">nrow =</span> nr, </span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(Zinfl)[(nrstart<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(nrstart<span class="sc">+</span>nr)] <span class="ot">&lt;-</span> <span class="fu">paste</span>(rname, </span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>                                                     <span class="dv">1</span><span class="sc">:</span>nr, </span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>  nrstart <span class="ot">&lt;-</span> nrstart <span class="sc">+</span> nr</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute mean/sd ------</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>Zinfl_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(Zinfl, <span class="dv">2</span>, mean)</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Zinfl)</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>Zinfl_sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(Zinfl, <span class="dv">2</span>, </span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">function</span>(x) <span class="fu">sd</span>(x)<span class="sc">*</span><span class="fu">sqrt</span>((n<span class="dv">-1</span>)<span class="sc">/</span>n))</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Zstand ------</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>Zstand2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(Z1, </span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>                 <span class="at">center =</span> Zinfl_mean,</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">scale =</span> Zinfl_sd)</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(Zstand2<span class="sc">/</span>Zstand <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="scaling-type-1" class="level3">
<h3 class="anchored" data-anchor-id="scaling-type-1">Scaling type 1</h3>
<p>Here, <span class="math inline">\(\chi^2\)</span> distances between rows (sites) are preserved they are positioned at the centroid of species.</p>
<ul>
<li>the rows (sites) scores can be positioned by averaging: <span class="math inline">\(U^\star = U \Lambda^{1/2}\)</span> (<code>ls</code>) or by predicted positions <span class="math inline">\(Z_1 = D_r^{-1/2} \hat{P_0} V_0\)</span> (<code>li</code>)</li>
<li>the columns (species) scores are positioned at variance 1 <span class="math inline">\(V = D_c^{-1/2} V_0\)</span> (<code>c1</code>)</li>
<li>the explanatory variable score are <span class="math inline">\(BS_1 = E_{stand}^\top D_r Z_{stand}\Lambda^{1/2}\)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rows WA scores</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>Ustar <span class="ot">&lt;-</span> U <span class="sc">%*%</span> <span class="fu">diag</span>(lambda<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables correlation</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>BS1 <span class="ot">&lt;-</span> <span class="fu">t</span>(Estand) <span class="sc">%*%</span> Dr <span class="sc">%*%</span> Zstand <span class="sc">%*%</span> <span class="fu">sqrt</span>(Lambda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we compare to the results obtained with ade4, we can see what each score corresponds to.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(Z1<span class="sc">/</span>cca<span class="sc">$</span>li) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Predicted sites scores</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(Ustar<span class="sc">/</span>cca<span class="sc">$</span>ls) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Averaging sites scores</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(V<span class="sc">/</span>cca<span class="sc">$</span>c1) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Variance 1 species scores</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What does the BS1 correspond to?</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cca<span class="sc">$</span>cor)<span class="sc">/</span>(BS1 <span class="sc">%*%</span> <span class="fu">diag</span>(lambda<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) )</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(res) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We know that <span class="math inline">\(V\)</span>/<code>c1</code> is of variance 1 (computed above). Below we show that <span class="math inline">\(Z_1\)</span>/<code>li</code> is of variance <span class="math inline">\(\lambda\)</span> and try to get the variance of <span class="math inline">\(U^\star\)</span>/<code>ls</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The CCA weights can be recovered from data (modulo a constant)</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>cca<span class="sc">$</span>lw<span class="sc">/</span>E_wt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3          4          5          6          7 
0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 
         8          9         10         11         12         13         14 
0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 
        15         16         17         18         19         20         21 
0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 
        22         23         24         25         26 
0.05273834 0.05273834 0.05273834 0.05273834 0.05273834 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>cca<span class="sc">$</span>cw<span class="sc">/</span>(<span class="fu">colSums</span>(Y)<span class="sc">/</span><span class="fu">ncol</span>(Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       sp1        sp2        sp3        sp4        sp5        sp6        sp7 
0.04259635 0.04259635 0.04259635 0.04259635 0.04259635 0.04259635 0.04259635 
       sp8        sp9       sp10       sp11       sp12       sp13       sp14 
0.04259635 0.04259635 0.04259635 0.04259635 0.04259635 0.04259635 0.04259635 
      sp15       sp16       sp17       sp18       sp19       sp21       sp22 
0.04259635 0.04259635 0.04259635 0.04259635 0.04259635 0.04259635 0.04259635 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(Z1, <span class="dv">2</span>, varwt, <span class="at">wt =</span> cca<span class="sc">$</span>lw)<span class="sc">/</span>cca<span class="sc">$</span>eig <span class="co"># Z1 variance = eigenvalues</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(Ustar, <span class="dv">2</span>, varwt, <span class="at">wt =</span> cca<span class="sc">$</span>lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.24702157 0.22874662 0.15097579 0.15129471 0.09999697 0.03937424</code></pre>
</div>
</div>
<section id="weighted-averaging" class="level4">
<h4 class="anchored" data-anchor-id="weighted-averaging">Weighted averaging</h4>
<p>Similarly to the <a href="./CA.html#weighted-averaging">CA case</a>, <span class="math inline">\(U^\star\)</span> (sites coordinates) can be obtained from species coordinates, weighted by the observed data matrix:</p>
<p><span id="eq-wa-sites"><span class="math display">\[
U^\star = \left\{
\begin{array}{ll}
  D_r^{-1/2} P_0 V_0 \qquad &amp;\text{(from } V_0 \text{)}\\
  D_r^{-1/2} P_0 D_c^{1/2} V \qquad &amp;\text{(from } V \text{)}\\
   D_r^{-1} P V \qquad &amp;\text{(from } V \text{ and } P \text{)}\\
\end{array}
\right.
\tag{1}\]</span></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With V0</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>Ustar_wa <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> P0 <span class="sc">%*%</span> V0</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> Ustar_wa<span class="sc">/</span>Ustar</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(res[, <span class="dv">1</span><span class="sc">:</span>neig] <span class="sc">-</span> <span class="dv">1</span> <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With V</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>Ustar_wa_V <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> P0 <span class="sc">%*%</span> <span class="fu">diag</span>(dc<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> V</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> Ustar_wa_V<span class="sc">/</span>Ustar</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(res[, <span class="dv">1</span><span class="sc">:</span>neig] <span class="sc">-</span> <span class="dv">1</span> <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With V and P</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>Ustar_wa_legendre <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%*%</span> P <span class="sc">%*%</span> V</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> Ustar_wa_legendre<span class="sc">/</span>Ustar</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(res[, <span class="dv">1</span><span class="sc">:</span>neig] <span class="sc">-</span> <span class="dv">1</span> <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="plots" class="level4">
<h4 class="anchored" data-anchor-id="plots">Plots</h4>
<p>In these plots, we use <span class="math inline">\(V\)</span>/<code>c1</code> for species coordinates.</p>
<p>For sites, we can plot the predicted scores for sites (LC scores = <span class="math inline">\(Z_1\)</span>/<code>li</code>):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>mult <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># LC scores</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(<span class="at">indiv_row =</span> Z1, <span class="at">indiv_col =</span> V, </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">indiv_row_lab =</span> <span class="fu">rownames</span>(Y), <span class="at">indiv_col_lab =</span> <span class="fu">colnames</span>(Y), </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">var_row =</span> BS1, <span class="at">var_row_lab =</span> <span class="fu">colnames</span>(E),</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">row_color =</span> params<span class="sc">$</span>colsite, <span class="at">col_color =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">mult =</span> mult,</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">eig =</span> lambda) <span class="sc">+</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"LC scores for sites and species</span><span class="sc">\n</span><span class="st">normed at 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(cca<span class="sc">$</span>c1, <span class="co"># Species constrained at variance 1</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"LC scores for sites and species</span><span class="sc">\n</span><span class="st">normed at 1"</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(cca<span class="sc">$</span>li, <span class="co"># Predicted sites scores</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also plot the WA scores for sites (<span class="math inline">\(U^\star\)</span>/<code>ls</code>):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># WA scores</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(<span class="at">indiv_row =</span> Ustar, <span class="at">indiv_col =</span> V, </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">indiv_row_lab =</span> <span class="fu">rownames</span>(Y), <span class="at">indiv_col_lab =</span> <span class="fu">colnames</span>(Y), </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">var_row =</span> BS1, <span class="at">var_row_lab =</span> <span class="fu">colnames</span>(E),</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">row_color =</span> params<span class="sc">$</span>colsite, <span class="at">col_color =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">mult =</span> mult,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">eig =</span> lambda) <span class="sc">+</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"WA scores for sites and species</span><span class="sc">\n</span><span class="st">normed at 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(cca<span class="sc">$</span>c1, <span class="co"># Species constrained at variance 1</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"WA scores for sites and species</span><span class="sc">\n</span><span class="st">normed at 1"</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(cca<span class="sc">$</span>ls, <span class="co"># WA sites scores</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="scaling-type-2" class="level3">
<h3 class="anchored" data-anchor-id="scaling-type-2">Scaling type 2</h3>
<p>Here, <span class="math inline">\(\chi^2\)</span> distances between columns (species) are preserved they are positioned at the centroid of sites.</p>
<ul>
<li>the rows (sites) scores can be <span class="math inline">\(U = D_r^{-1/2} U_0\)</span> (variance 1) or <span class="math inline">\(Z_2 = D_r^{-1/2} \hat{P_0} V_0 \Lambda^{-1/2}\)</span> (<code>l1</code>) (predicted sites scores)</li>
<li>the columns (species) scores are <span class="math inline">\(V^\star = V \Lambda^{1/2}\)</span> (<code>co</code>) (WA scores from sites latent ordination)</li>
<li>the explanatory variable score are <span class="math inline">\(BS_2 = E_{stand}^\top D_r Z_{stand}\)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Row predicted scores</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>Z2 <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> P0hat <span class="sc">%*%</span> V0 <span class="sc">%*%</span> <span class="fu">diag</span>(lambda<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns WA scores</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>Vstar <span class="ot">&lt;-</span> V <span class="sc">%*%</span> Lambda<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables correlation</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>BS2 <span class="ot">&lt;-</span> <span class="fu">t</span>(Estand) <span class="sc">%*%</span> Dr <span class="sc">%*%</span> Zstand</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we compare to the results obtained with ade4, we can see what each score corresponds to.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(Z2<span class="sc">/</span>cca<span class="sc">$</span>l1) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Predicted sites scores of variance 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># U is not computed by ade4 so we compute it from ls (corresponding to Ustar)</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>ls1_ade4 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cca<span class="sc">$</span>ls) <span class="sc">%*%</span> <span class="fu">diag</span>(lambda<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(ls1_ade4<span class="sc">/</span>U) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(Vstar<span class="sc">/</span>cca<span class="sc">$</span>co) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Averaging column scores</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(cca<span class="sc">$</span>cor<span class="sc">/</span>BS2) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># Variables correlations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Below we show that <span class="math inline">\(V^\star\)</span>/<code>co</code> is of variance <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(Z_2\)</span>/<code>l1</code> is of variance 1 and try to get the variance of <span class="math inline">\(U\)</span>/<code>ls1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(Vstar, <span class="dv">2</span>, varwt, <span class="at">wt =</span> cca<span class="sc">$</span>cw)<span class="sc">/</span>cca<span class="sc">$</span>eig <span class="co"># Vstar variance = eigenvalues</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(Z2, <span class="dv">2</span>, varwt, <span class="at">wt =</span> cca<span class="sc">$</span>lw) <span class="co"># Z variance = 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(ls1_ade4, <span class="dv">2</span>, varwt, <span class="at">wt =</span> cca<span class="sc">$</span>lw) <span class="co"># ?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.337729 1.455514 1.495549 1.736722 3.103141 2.666784</code></pre>
</div>
</div>
<section id="weighted-averaging-1" class="level4">
<h4 class="anchored" data-anchor-id="weighted-averaging-1">Weighted averaging</h4>
<p><span class="math inline">\(V^\star\)</span> (species coordinates) can be obtained from sites coordinates, weighted by the <em>predicted</em> data matrix. Contrary to the <a href="./CA.html#weighted-averaging-1">CA case</a>, sites coordinates are not weighted by <span class="math inline">\(P_0\)</span> (observed) but by <span class="math inline">\(\hat{P}_0\)</span> (predicted):</p>
<p><span id="eq-wa-spp"><span class="math display">\[
V^\star = \left\{
\begin{array}{ll}
  D_c^{-1/2} \hat{P}_0^\top U_0 \qquad &amp;\text{(from } U_0 \text{)}\\
  D_c^{-1/2} \hat{P}_0^\top D_r^{1/2} U \qquad &amp;\text{(from } U \text{)}
\end{array}
\right.
\tag{2}\]</span></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># U0</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>Vstar_wa <span class="ot">&lt;-</span> <span class="fu">diag</span>(dc<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> <span class="fu">t</span>(P0hat) <span class="sc">%*%</span> U0</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> Vstar_wa<span class="sc">/</span>Vstar</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(res[, <span class="dv">1</span><span class="sc">:</span>neig] <span class="sc">-</span> <span class="dv">1</span> <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># U</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>Vstar_wa_U <span class="ot">&lt;-</span> <span class="fu">diag</span>(dc<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> <span class="fu">t</span>(P0hat) <span class="sc">%*%</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> U</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> Vstar_wa_U<span class="sc">/</span>Vstar</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(res[, <span class="dv">1</span><span class="sc">:</span>neig] <span class="sc">-</span> <span class="dv">1</span> <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tests with score Z2</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>Vstar_wa_Z <span class="ot">&lt;-</span> <span class="fu">diag</span>(dc<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%*%</span> <span class="fu">t</span>(P) <span class="sc">%*%</span> Z2</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> Vstar_wa_Z<span class="sc">/</span>Vstar</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(res[, <span class="dv">1</span><span class="sc">:</span>neig] <span class="sc">-</span> <span class="dv">1</span> <span class="sc">&lt;</span> zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="plots-1" class="level4">
<h4 class="anchored" data-anchor-id="plots-1">Plots</h4>
<p>In these plots, we always use WA scores (<span class="math inline">\(V^\star\)</span>/<code>co</code>) for the columns.</p>
<p>We can plot the columns WA scores (<span class="math inline">\(V^\star\)</span>/<code>co</code>) with the predicted scores for sites (LC scores) (<span class="math inline">\(Z_2\)</span>/<code>l1</code>):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>mult <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co"># LC scores</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(<span class="at">indiv_row =</span> Z2, <span class="at">indiv_col =</span> Vstar, </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">indiv_row_lab =</span> <span class="fu">rownames</span>(Y), <span class="at">indiv_col_lab =</span> <span class="fu">colnames</span>(Y), </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">var_row =</span> BS2, <span class="at">var_row_lab =</span> <span class="fu">colnames</span>(E),</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">row_color =</span> params<span class="sc">$</span>colsite, <span class="at">col_color =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">mult =</span> mult,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">eig =</span> lambda) <span class="sc">+</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Specis WA scores with</span><span class="sc">\n</span><span class="st">sites LC scores of variance 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(cca<span class="sc">$</span>l1, <span class="co"># Predicted sites scores of variance 1</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Specis WA scores with</span><span class="sc">\n</span><span class="st">sites LC scores of variance 1"</span>)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(cca<span class="sc">$</span>co, <span class="co"># Species WA</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s.corcircle</span>(cca<span class="sc">$</span>cor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-45-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also plot columns WA scores (<span class="math inline">\(V^\star\)</span>/<code>co</code>) with the sites observed scores (<span class="math inline">\(U\)</span>/“<code>ls1</code>” (not computed by ade4)):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># WA scores</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(<span class="at">indiv_row =</span> U, <span class="at">indiv_col =</span> Vstar, </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">indiv_row_lab =</span> <span class="fu">rownames</span>(Y), <span class="at">indiv_col_lab =</span> <span class="fu">colnames</span>(Y), </span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">var_row =</span> BS2, <span class="at">var_row_lab =</span> <span class="fu">colnames</span>(E),</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">row_color =</span> params<span class="sc">$</span>colsite, <span class="at">col_color =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">mult =</span> mult,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">eig =</span> lambda) <span class="sc">+</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Specis WA scores with</span><span class="sc">\n</span><span class="st">sites observed scores of variance 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>ade4 does not compute the sites observed scores normed at 1 (corresponding to <span class="math inline">\(U\)</span>), so we compute them as <span class="math inline">\(\text{ls1} = \text{ls} \Lambda^{-1/2}\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(cca<span class="sc">$</span>ls) <span class="sc">%*%</span> <span class="fu">diag</span>(lambda<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]        [,2]        [,3]        [,4]        [,5]         [,6]
1  -0.88194233 -0.89920813 -0.21510290 -0.75716763 -3.36433191  5.943824594
2   2.42444621 -0.30829774 -3.35321943  0.55963296  2.02916596  2.065563431
3  -0.34444473 -0.54181178 -0.08013664  0.57546029 -0.80398947  0.006814482
4   0.01419785 -1.26123684  1.34364884  1.79619359  1.59088842  1.764336111
5   0.04325107 -0.64051246  0.03049116  1.11682527 -0.74470162  1.355608210
6   0.71217106 -1.08445507  0.05021373  0.26782893  0.82751939 -1.185111342
7   1.35808644 -0.32688745  1.36849015 -0.06717237  1.40265285 -1.169991512
8   1.13927090  1.87131126  0.51489605  1.22937814 -1.90204431 -1.972136233
9   0.18631749 -0.69064739  1.56174573  0.49605602 -1.54800058 -1.044143121
10  1.24074453 -0.88393142  1.11709208 -1.88081630 -1.87523745  0.694839896
11  1.17040343 -1.40649896 -1.45445191  0.15749382 -0.70665751 -1.226713778
12  0.87979967  0.19023028  1.61346288 -0.66352718 -0.77675967 -1.410272996
13  0.53426380  3.36712361  1.01348658 -1.59561837  1.77100897  1.536210292
14 -1.42844996  0.48874250 -0.51552864  0.83759576 -1.39780352 -0.793502333
15 -0.30279177  2.40395635 -0.90288926 -0.17353516  3.64804877  0.066157822
16 -0.80715875 -0.15220790 -0.00359762  1.08059321  0.72058755  2.171252757
17 -0.62521546 -1.10958406  0.42720293  0.71161391 -0.28552526  2.455843219
18 -1.12871615 -0.45121491  0.52408704  1.79661165 -0.46072861  0.013919785
19 -1.32962334 -0.02131165  0.22268095 -1.76305566  2.21983155 -0.645198949
20 -0.71010429 -0.50179403  0.79488259  1.57807386  1.63438894 -2.298299831
21 -1.49191348  0.43981741 -0.22249008  1.27068234 -1.31901558 -0.764324772
22 -0.92914770 -0.56566757  0.17354832  0.51597625  0.01408031 -0.288080450
23 -1.18010511 -0.17836577 -0.02322108 -2.68084807  3.05668242  0.997011359
24 -1.71254285  0.11121758 -1.76025623 -2.07277698 -1.45573752 -2.393217624
25 -0.79823857  1.75933428 -0.09999050  0.83358035 -3.48847449 -0.953485788
26 -0.85502843  1.92516632  0.29281684  1.85795073 -2.41935625 -0.211052481</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(ls1_ade4, <span class="co"># Sites WA scores U</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Specis WA scores with</span><span class="sc">\n</span><span class="st">sites observed scores of variance 1"</span>)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(cca<span class="sc">$</span>co, <span class="co"># Species WA</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="scaling-type-3" class="level3">
<h3 class="anchored" data-anchor-id="scaling-type-3">Scaling type 3</h3>
<p>This type of scaling is a compromise between scalings type 1 and 2.</p>
<ul>
<li>the rows (sites) scores can be <span class="math inline">\(\hat{S}_3 = U \Lambda^{1/4}\)</span> or <span class="math inline">\(Z_3 = D_r^{-1/2} \hat{P_0} V_0 \Lambda^{-1/4}\)</span></li>
<li>the columns (species) scores are <span class="math inline">\(S_3 = V \Lambda^{1/4}\)</span></li>
<li>the explanatory variable score are <span class="math inline">\(BS_3 = E_{stand}^\top D_r Z_{stand} \Lambda^{1/4}\)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Row scores</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>Shat3 <span class="ot">&lt;-</span> U <span class="sc">%*%</span> Lambda<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="co"># Latent scores</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>Z3 <span class="ot">&lt;-</span> <span class="fu">diag</span>(dr<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%*%</span> P0hat <span class="sc">%*%</span> V0 <span class="sc">%*%</span> <span class="fu">diag</span>(lambda<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)) <span class="co"># Predicted scores</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns scores</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>S3 <span class="ot">&lt;-</span> V <span class="sc">%*%</span> Lambda<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables correlation</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>BS3 <span class="ot">&lt;-</span> <span class="fu">t</span>(Estand) <span class="sc">%*%</span> Dr <span class="sc">%*%</span> Zstand <span class="sc">%*%</span> Lambda<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The corresponding ade4 values are not computed, but we can compute them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>Z3_ade4 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cca<span class="sc">$</span>l1) <span class="sc">%*%</span> <span class="fu">diag</span>(cca<span class="sc">$</span>eig<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>Shat3_ade4 <span class="ot">&lt;-</span> ls1_ade4 <span class="sc">%*%</span> <span class="fu">diag</span>(cca<span class="sc">$</span>eig<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>S3_ade4 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cca<span class="sc">$</span>c1) <span class="sc">%*%</span> <span class="fu">diag</span>(cca<span class="sc">$</span>eig<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(Z3_ade4<span class="sc">/</span>Z3) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># LC scores for sites</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(Shat3_ade4<span class="sc">/</span>Shat3) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># sites scores</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">abs</span>(<span class="fu">abs</span>(S3_ade4<span class="sc">/</span>S3) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> zero) <span class="co"># species scores</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="plots-2" class="level3">
<h3 class="anchored" data-anchor-id="plots-2">Plots</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LC scores</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(<span class="at">indiv_row =</span> Z3, <span class="at">indiv_col =</span> S3, </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">indiv_row_lab =</span> <span class="fu">rownames</span>(Y), <span class="at">indiv_col_lab =</span> <span class="fu">colnames</span>(Y), </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">var_row =</span> BS3, <span class="at">var_row_lab =</span> <span class="fu">colnames</span>(E),</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">row_color =</span> params<span class="sc">$</span>colsite, <span class="at">col_color =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">mult =</span> mult,</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">eig =</span> lambda) <span class="sc">+</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"LC scores for sites"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(Z3_ade4,</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colsite)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(S3_ade4,</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>mult <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(<span class="at">indiv_row =</span> Shat3, <span class="at">indiv_col =</span> S3, </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">indiv_row_lab =</span> <span class="fu">rownames</span>(Y), <span class="at">indiv_col_lab =</span> <span class="fu">colnames</span>(Y), </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">var_row =</span> BS3, <span class="at">var_row_lab =</span> <span class="fu">colnames</span>(E),</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">row_color =</span> params<span class="sc">$</span>colsite, <span class="at">col_color =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">mult =</span> mult,</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">eig =</span> lambda) <span class="sc">+</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Sites latent scores"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(Shat3_ade4,</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colsite,</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colsite)</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(S3_ade4,</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.optim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">plabels.col  =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">ppoints.col =</span> params<span class="sc">$</span>colspp,</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="interpretation" class="level2">
<h2 class="anchored" data-anchor-id="interpretation">Interpretation</h2>
<p>In CCA, each ordination axis corresponds to a linear combination of the explanatory variables that maximizes the explained variance in the response data.</p>
<p>This analysis constrains rows (sites) scores to be linear combinations of the environmental variables (scaling <span class="math inline">\(Z_i\)</span>).</p>
<p>Species can be ordered along environmental variables axes by projecting species coordinates on the vector of this variable. This gives species niche optimum, but there are strong assumptions:</p>
<ul>
<li>unimodal distribution of niches preferences along the variable of interest</li>
<li>species distributions are indeed controlled by the environment</li>
<li>the study gradient is long enough to capture the range of species abundance variation.</li>
</ul>
<p>The part of variation explained by the environmental variables can be computed as</p>
<p><span class="math display">\[
\frac{\sum_k \lambda_k(CCA)}{\sum_l \lambda_l(CA)}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(lambda)<span class="sc">/</span><span class="fu">sum</span>(ca<span class="sc">$</span>eig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3795835</code></pre>
</div>
</div>
<p>Here, the environmental variables explain 38 % of the total variation.</p>
<p>Warning: in CCA, using noisy or not relevant explanatory variables leads to spurious relationships.</p>
<section id="residual-analysis" class="level3">
<h3 class="anchored" data-anchor-id="residual-analysis">Residual analysis</h3>
<p>In order to examinate residuals, a CA can be performed on the table of residuals <span class="math inline">\(P_{\text{res}}\)</span>:</p>
<p><span class="math display">\[
P_{\text{res}} = P_0 - \hat{P}_0
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>Pres <span class="ot">&lt;-</span> P0 <span class="sc">-</span> P0hat</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>res_pca <span class="ot">&lt;-</span> <span class="fu">dudi.pca</span>(Pres, <span class="at">scannf =</span> <span class="cn">FALSE</span>, <span class="at">nf =</span> <span class="dv">27</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(res_pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="CCA_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="tests-of-significance" class="level3">
<h3 class="anchored" data-anchor-id="tests-of-significance">Tests of significance</h3>
<p>It is possible to test the significance of the the relationship between <span class="math inline">\(E\)</span> and <span class="math inline">\(Y\)</span> with a permutation test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">randtest</span>(cca, <span class="at">nrepet =</span> <span class="dv">999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Monte-Carlo test
Call: randtest.pcaiv(xtest = cca, nrepet = 999)

Observation: 0.3795835 

Based on 999 replicates
Simulated p-value: 0.002 
Alternative hypothesis: greater 

     Std.Obs  Expectation     Variance 
3.6946237959 0.2679328228 0.0009132344 </code></pre>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-legendre2012" class="csl-entry" role="listitem">
Legendre, P., and Louis Legendre. 2012. <em>Numerical Ecology</em>. Elsevier.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>